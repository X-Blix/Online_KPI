{% extends "layout/basic.html" %}
{% block content %}
<div class="row">
  <div class="medium-9 columns">
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">ğŸ¯ KPIæŒ‡æ ‡é…ç½®</h1>
      </div>
      
      <div class="section__body" style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
        <form method="post">
          <!-- åŸºç¡€ä¿¡æ¯åŒºåŸŸ -->
          <div class="row">
            <div class="medium-3 columns">
              <label style="font-weight: bold; color: #555;">
                {{ _('pid') }}
                <input name="pid" placeholder="P1000" value="{{ pdoc['pid']|default('') }}" class="textbox" style="background: white; margin-top: 5px;">
              </label>
            </div>
            <div class="medium-7 columns">
              <label style="font-weight: bold; color: #555;">
                {{ _('Title') }}
                <input name="title" placeholder="{{ _('title') }}" value="{{ pdoc['title']|default('') }}" class="textbox" style="background: white; margin-top: 5px;"{% if page_name == 'problem_create' %} autofocus{% endif %}>
              </label>
            </div>
            <div class="medium-2 columns">
              <label style="font-weight: bold; color: #555; display: block; margin-top: 25px;">
                <label class="checkbox">
                  <input type="checkbox" name="hidden" value="on"{% if pdoc['hidden'] %} checked{% endif %} class="checkbox"> {{ _('Hidden') }}
                </label>
              </label>
            </div>
          </div>
          
          <div class="row" style="margin-top: 15px;">
            {{ form.form_text({
                 row:false,
                 columns:9,
                 label:'Tags',
                 help_text:'Split by \', \'.',
                 name:'tag',
                 value:pdoc['tag']|default([])|join(', ')
               }) }}
            {{ form.form_text({
                 row:false,
                 columns:3,
                 label:'Difficulty',
                 help_text:'From 1-10',
                 name:'difficulty',
                 value:pdoc['difficulty'] or ''
               }) }}
          </div>

          <!-- KPIå­—æ®µåŒºåŸŸ -->
          <div style="border-top: 2px solid #3498db; margin: 25px 0; padding-top: 20px;">
            <h3 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">KPIè¯¦ç»†é…ç½®</h3>
            
            <div class="row">
              {# æŒ‡æ ‡ç±»å‹ï¼šåŒºåˆ†æŒ‡æ ‡æ˜¯å®šé‡è¿˜æ˜¯å®šæ€§ã€‚é‡‡ç”¨ä¸‹æ‹‰é€‰æ‹©æ¡† #}
              <div class="medium-4 columns">
                <label style="font-weight: bold; color: #555;">æŒ‡æ ‡ç±»å‹</label>
                <select name="indicatorType" class="textbox" style="margin-top: 8px; background: white;">
                  <option value="quantitative">ğŸ“ˆ å®šé‡æŒ‡æ ‡</option>
                  <option value="qualitative">ğŸ“ å®šæ€§æŒ‡æ ‡</option>
                </select>
              </div>
              <div class="medium-4 columns">
                {# ç”¨äºè®¾å®šå…·ä½“çš„ç»©æ•ˆç›®æ ‡æ•°å€¼ï¼Œæ˜¯æ•°å­—è¾“å…¥æ¡† #}
                <label style="font-weight: bold; color: #555;">ç›®æ ‡å€¼</label>
                <input type="number" name="targetValue" placeholder="ä¾‹å¦‚ï¼š100" class="textbox" style="margin-top: 8px; background: white;" value="{{ pdoc['targetValue']|default('') }}">
              </div>
              <div class="medium-4 columns">
                {# æƒé‡:buchang 0.1 fanwei  0.0 -1.0 #}
                <label style="font-weight: bold; color: #555;">æƒé‡</label>
                <input type="number" name="weight" step="0.1" min="0" max="1" placeholder="0.0-1.0" class="textbox" style="margin-top: 8px; background: white;" value="{{ pdoc['weight']|default('1.0') }}">
              </div>
            </div>

            <div class="row" style="margin-top: 15px;">
              <div class="medium-6 columns">
                {# å•ä½:ç”¨äºå®šä¹‰ç›®çš„å€¼çš„è®¡é‡å•ä½ #}
                <label style="font-weight: bold; color: #555;">å•ä½</label>
                <input type="text" name="unit" placeholder="ä¾‹å¦‚ï¼šä¸‡å…ƒã€ä¸ªã€%" class="textbox" style="margin-top: 8px; background: white;" value="{{ pdoc['unit']|default('') }}">
              </div>
              <div class="medium-6 columns">
                {# æŒ‡å®šè¯¥KPIé€‚ç”¨çš„ç»„ç»‡éƒ¨é—¨ï¼šé”€å”®éƒ¨ã€æŠ€æœ¯éƒ¨ç­‰ #}
                <label style="font-weight: bold; color: #555;">é€‚ç”¨éƒ¨é—¨</label>
                <input type="text" name="applicableDepartment" placeholder="ä¾‹å¦‚ï¼šé”€å”®éƒ¨" class="textbox" style="margin-top: 8px; background: white;" value="{{ pdoc['applicableDepartment']|default('') }}">
              </div>
            </div>
            {# è¯„åˆ†æ ‡å‡†ï¼šç”¨äºå®šä¹‰ç»©æ•ˆç­‰çº§åˆ’åˆ†è§„åˆ™ #}
            <div style="margin-top: 15px;">
              <label style="font-weight: bold; color: #555;">è¯„åˆ†æ ‡å‡†</label>
              <textarea name="evaluationCriteria" placeholder="ä¾‹å¦‚ï¼šâ‰¥90:ä¼˜ç§€, â‰¥80:è‰¯å¥½, â‰¥60:åˆæ ¼" class="textbox" style="height: 80px; margin-top: 8px; background: white;">{{ pdoc['evaluationCriteria']|default('') }}</textarea>
            </div>
          </div>

          <!-- å…¶ä»–è¡¨å•å†…å®¹ -->
          <div class="section__tab-container nojs--hide">
            <div class="section__tab-header-wrapper">
              <ul class="section__tab-header">
                <li class="section__tab-header-item tab--active" data-lang="{{ _('__id') }}">{{ _('__langname') }}</li>
                {% for k, v in statementLangs %}{% if k != handler.user.viewLang %}
                  <li class="section__tab-header-item" data-lang="{{ k }}">{{ v }}</li>
                {% endif %}{% endfor %}
              </ul>
            </div>
          </div>
          
          <div><textarea data-editor{% if page_name == 'problem_edit' %} autofocus{% endif %} class="textbox auto-resize nojs--hide"></textarea></div>
          <textarea name="content" class="textbox hasjs--hide" data-markdown-upload style="height: 500px">{% if pdoc %}{{ pdoc['content']|toString }}{% else %}{% include 'partials/problem_default.md' %}{% endif %}</textarea>
          
          <div class="row">
            <div class="columns">
              {% if page_name == 'problem_edit' %}
                <button type="submit" class="rounded primary button">
                  {{ _('Update') }}
                </button>
                {% if handler.user.own(pdoc, perm.PERM_EDIT_PROBLEM_SELF) or handler.user.hasPerm(perm.PERM_EDIT_PROBLEM) %}
                  <button name="operation" value="delete" type="submit" class="rounded button">
                    {{ _('Delete') }}
                  </button>
                {% endif %}
              {% else %}
                <button type="submit" class="rounded primary button">
                  {{ _('Create') }}
                </button>
              {% endif %}
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- å³ä¾§è¾¹æ ä¿æŒä¸å˜ -->
  <div class="medium-3 columns">
    <div class="section side visiable nojs--hide section--problem-sidebar-tags">
      <div class="section__header">
        <h1 class="section__title">{{ _('Categories') }} ({{ _('click to add') }})</h1>
      </div>
      <div class="section__body problem-sidebar-tags__detail">
        {% include "partials/category.html" %}
      </div>
    </div>
    {% if page_name == 'problem_edit' %}
      <div class="section side" data-type="additional_file" data-sidebar>
        <div class="section__header">
          <h1 class="section__title">{{_('Additional Files')}}</h1>
          <div class="section__tools">
            <button class="primary rounded button" name="upload_file">{{ _('Upload') }}</button>
          </div>
        </div>
        {% set sidebar = true %}
        {% set can_edit = true %}
        {% set filetype = "additional_file" %}
        {% include "partials/problem_files.html" %}
      </div>
      {% include "partials/problem_sidebar.html" %}
    {% else %}
      {% include 'components/md_hint.html' %}
    {% endif %}
  </div>
</div>
{% endblock %}