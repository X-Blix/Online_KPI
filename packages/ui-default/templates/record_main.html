{# ç»©æ•ˆå¡«æŠ¥è®°å½•ä¸»é¡µé¢çš„æ¨¡ç‰ˆã€‚ç»©æ•ˆå¡«æŠ¥è®°å½•åˆ—è¡¨é¡µé¢çš„å®Œæ•´å®ç° #}
{% extends "layout/basic.html" %}
{% block content %}
{# å®æ—¶æ›´æ–°è®¾ç½® #}
{{ set(
  UiContext, 'socketUrl',
  "record-conn?domainId=" + handler.args.domainId
  + (("&tid=" + filterTid) if filterTid else "")
  + (("&uidOrName=" + filterUidOrName) if filterUidOrName else "")
  + (("&pid=" + filterPid) if filterPid else "")
  + ("&all=1" if all else "")
  + ("&allDomain=1" if allDomain else "")
) }}
{{ set(UiContext, 'rids', rdocs.map(eval("rdoc=>rdoc._id.toString()"))) }}
<div class="row">
  <div class="medium-12 columns">
    {# ç­›é€‰è¡¨å•åŒºåŸŸ #}
    <form method="get">
      <div class="section">
        <div class="section__header">
          <h1 class="section__title">ğŸ“Š ç»©æ•ˆè®°å½•ç­›é€‰</h1>
          <div class="section__tools">
            <button type="submit" class="primary button"><span class="icon icon-filter"></span> ç­›é€‰</button>
            <a href="{{ url('record_main') }}" class="button">é‡ç½®</a>
          </div>
        </div>
        <div class="section__body">
          <div class="row">
            {# ç­›é€‰æ¡ä»¶ #}
            <div class="medium-2 columns">
              <label class="filter-user">   
                å¡«æŠ¥äººå‘˜
                <input name="uidOrName" type="text" class="textbox" value="{{ filterUidOrName }}" autocomplete="off" data-autofocus>
              </label>
            </div>
            <div class="medium-2 columns">
              <label>
                KPIæŒ‡æ ‡
                <input name="pid" type="text" class="textbox" value="{{ filterPid }}">
              </label>
            </div>
            <div class="medium-2 columns">
              <label>
                è€ƒæ ¸å‘¨æœŸ
                <input name="tid" type="text" class="textbox" value="{{ filterTid }}">
              </label>
            </div>
            <div class="medium-3 columns">
              <label>
                å®¡æ ¸çŠ¶æ€
              </label>
              <select class="compact select" name="status">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="pending" {% if filterStatus == 'pending' %}selected{% endif %}>â³ å¾…å®¡æ ¸</option>
                <option value="approved" {% if filterStatus == 'approved' %}selected{% endif %}>âœ… å·²é€šè¿‡</option>
                <option value="rejected" {% if filterStatus == 'rejected' %}selected{% endif %}>âŒ å·²æ‹’ç»</option>
              </select>
            </div>
            <div class="medium-3 columns">
              <label>
                æ’åºæ–¹å¼
              </label>
              <select class="compact select" name="sort">
                <option value="date">å¡«æŠ¥æ—¶é—´</option>
                <option value="score">ç»©æ•ˆå¾—åˆ†</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </form>
    {# è®°å½•åˆ—è¡¨åŒºåŸŸ #}
    <div class="section">
      <div class="section__body no-padding">
        {# ç©ºçŠ¶æ€å¤„ç† #}
      {% if not rdocs.length %} 
        {% if not filterUidOrName and not filterPid and not filterTid %}
        {{ nothing.render('ç›®å‰è¿˜æ²¡æœ‰ç»©æ•ˆå¡«æŠ¥è®°å½•ï¼') }}
        {% else %}
        {{ nothing.render('æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç»©æ•ˆè®°å½•ï¼') }}
        {% endif %}
      {% else %}
      {# æ•°æ®è¡¨æ ¼ #}
        <table class="data-table record_main__table">
          <colgroup>
            <col class="col--status">
            <col class="col--problem">
            <col class="col--submit-by">
            <col class="col--value">
            <col class="col--score">
            <col class="col--submit-at">
            <col class="col--actions">
          </colgroup>
          <thead>
            <tr>
              <th class="col--status record-status--border">å®¡æ ¸çŠ¶æ€</th>
              <th class="col--problem">KPIæŒ‡æ ‡</th>
              <th class="col--submit-by">å¡«æŠ¥äººå‘˜</th>
              <th class="col--value">å®Œæˆæ•°å€¼</th>
              <th class="col--score">ç»©æ•ˆå¾—åˆ†</th>
              <th class="col--submit-at">å¡«æŠ¥æ—¶é—´</th>
              <th class="col--actions">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
          {%- for rdoc in rdocs -%}
            {% set udoc = udict[rdoc['uid']] %}
            {% set pdoc = pdict[rdoc['pid']] %}
            {% include 'record_main_tr.html' %}
          {%- endfor -%}
          </tbody>
        </table>
        {# åˆ†é¡µå™¨ #}
        {% if handler.user.hasPriv(PRIV.PRIV_VIEW_JUDGE_STATISTICS) or filterTid or filterPid or filterUidOrName %}
        <ul class="pager">
          <li>
            <a class="pager__item next link" href="?page={{ page + 1 }}{{
              (('&tid=' + filterTid) if filterTid else '')
              + (('&uidOrName=' + filterUidOrName) if filterUidOrName else '')
              + (('&status=' + filterStatus) if filterStatus else '')
              + (('&pid=' + filterPid) if filterPid else '')
              + ('&all=1' if all else '')
              + ('&allDomain=1' if allDomain else '') }}">{{ _('pager_next') }}</a>
          </li>
        </ul>
        {% endif %}
      {% endif %}
      </div>
    </div>
    {# ç»Ÿè®¡ä¿¡æ¯åŒºåŸŸ - ä¿ç•™åŸæœ‰ç»Ÿè®¡ #}
    {% if statistics %}
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('Statistics') }}</h1>
      </div>
      <div class="section__body">
        <dl class="large horizontal">
          <dt>{{ _('5 Min')}}</dt><dd>{{ statistics['d5min'] }}</dd>
          <dt>{{ _('1 Hour')}}</dt><dd>{{ statistics['d1h'] }}</dd>
          <dt>{{ _('Day') }}</dt><dd>{{ statistics['day'] }}</dd>
          <dt>{{ _('Week') }}</dt><dd>{{ statistics['week'] }}</dd>
          <dt>{{ _('Month') }}</dt><dd>{{ statistics['month'] }}</dd>
          <dt>{{ _('Year') }}</dt><dd>{{ statistics['year'] }}</dd>
          <dt>{{ _('Total') }}</dt><dd>{{ statistics['total'] }}</dd>
        </dl>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
/* ç»©æ•ˆè®°å½•åˆ—è¡¨æ ·å¼ä¼˜åŒ– */
.col--value, .col--score {
  text-align: center;
}

.col--actions {
  text-align: center;
  width: 120px;
}

/* å®¡æ ¸çŠ¶æ€é¢œè‰² */
.status--pending { color: #ffc107; }
.status--approved { color: #28a745; }
.status--rejected { color: #dc3545; }
</style>
{% endblock %}